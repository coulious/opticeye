# Opticeye 瞳孔圆检测系统

## 项目概述
本项目是一款用于医疗器械的瞳孔变化检测系统，通过计算机视觉技术对二值化处理后的瞳孔照片进行实时圆检测，主要用于量化检测瞳孔直径的动态变化程度，为眼科医疗诊断提供数据支持。

## 核心功能
1. **实时圆检测**：通过OpenCV的霍夫圆变换算法，对二值化后的瞳孔图像进行圆检测，支持动态阈值过滤（基于前一帧直径的10%变化范围）和滑动平均平滑处理（窗口大小5），输出稳定的瞳孔直径数据。
2. **数据记录与管理**：支持检测数据（时间-直径序列）的实时保存（自动生成递增编号的JSON文件）、历史数据加载（通过“上一个/下一个”按钮切换）。
3. **可视化界面**：包含三部分布局：左侧实时预览窗口（显示二值化图像及检测结果）、右侧实时图表（时间-直径曲线）、底部控制按钮（开始检测、保存、加载等）。

## 使用说明
### 依赖安装
需安装以下Python库（Python 3.8+）：
```bash
pip install opencv-python numpy matplotlib pillow tkinter
```
（注：tkinter通常为Python标准库，若缺失需通过系统包管理器安装）

### 运行步骤
1. 连接摄像头（默认使用索引1的摄像头，若需调整请修改`detect_circle`函数中的`cv2.VideoCapture(1)`参数）。
2. 执行主程序：
```bash
python circle_detection.py
```
3. 点击“Start Detection”开始检测，界面会实时显示瞳孔图像及直径曲线；检测完成后点击“Save Results”保存数据，通过“Load Previous/Next”查看历史记录。

## 参数配置
### 摄像头设置
- `cv2.VideoCapture(1)`：摄像头索引（0为默认摄像头，1为外接摄像头，根据实际设备调整）。

### 圆检测参数
- 霍夫圆变换参数：`dp=1`（图像分辨率与累加器分辨率比例），`minDist=500`（检测圆的最小间距），`param1=50`（Canny边缘检测上限阈值），`param2=5`（累加器阈值，越小检测到的圆越多），`minRadius=10`/`maxRadius=100`（检测圆的半径范围）。
- 动态阈值：基于前一有效直径的10%变化范围（最小5px）。
- 滑动窗口：保留最近5个有效直径数据，输出平均值。

## 文件结构
```
opticeye/
├─ circle_detection.py   # 主程序代码（包含检测逻辑、界面布局）
├─ 1.json/2.json/...      # 检测结果数据（格式：{"time": [时间序列], "diameter": [直径序列]}）
└─ test1.png/test2.jpg    # （可选）测试用瞳孔图片
```